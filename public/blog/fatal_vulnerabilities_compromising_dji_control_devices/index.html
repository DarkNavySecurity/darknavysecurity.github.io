<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Fatal Vulnerabilities Compromising DJI Control Devices | DARKNAVY</title>
<meta name=keywords content><meta name=description content="As logistics drones weave through buildings and surveying equipment delineates urban landscapes, the capillaries of the low-altitude economy are sketching the future with millimeter-level precision.
DARKNAVY consistently focuses on the construction and breaching of drone security defenses. In this research, we discovered a fatal exploit chain in DJI remote control devices, leading to the complete compromise of the security defenses within the DJI remote controller. How can we assist industry leader DJI in fortifying its security defenses? What potential risks do these vulnerabilities reveal? Welcome to read this article."><meta name=author content="DARKNAVY"><link rel=canonical href=https://www.darknavy.org/blog/fatal_vulnerabilities_compromising_dji_control_devices/><link crossorigin=anonymous href=/assets/css/stylesheet.2613b1460fae4b99a98c033e33bde5e6a3af84ddb20236b732cefe33e3c0781e.css integrity="sha256-JhOxRg+uS5mpjAM+M73l5qOvhN2yAja3Ms7+M+PAeB4=" rel="preload stylesheet" as=style><link rel=icon href=https://www.darknavy.org/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.darknavy.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.darknavy.org/favicon-32x32.png><link rel=apple-touch-icon href=https://www.darknavy.org/apple-touch-icon.png><link rel=mask-icon href=https://www.darknavy.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.darknavy.org/blog/fatal_vulnerabilities_compromising_dji_control_devices/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-LR4ZN1LSPS"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LR4ZN1LSPS")}</script><meta property="og:url" content="https://www.darknavy.org/blog/fatal_vulnerabilities_compromising_dji_control_devices/"><meta property="og:site_name" content="DARKNAVY"><meta property="og:title" content="Fatal Vulnerabilities Compromising DJI Control Devices"><meta property="og:description" content="As logistics drones weave through buildings and surveying equipment delineates urban landscapes, the capillaries of the low-altitude economy are sketching the future with millimeter-level precision.
DARKNAVY consistently focuses on the construction and breaching of drone security defenses. In this research, we discovered a fatal exploit chain in DJI remote control devices, leading to the complete compromise of the security defenses within the DJI remote controller. How can we assist industry leader DJI in fortifying its security defenses? What potential risks do these vulnerabilities reveal? Welcome to read this article."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-03-21T10:01:19+08:00"><meta property="article:modified_time" content="2025-03-21T10:01:19+08:00"><meta property="og:image" content="https://www.darknavy.org/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/a5d9daf9-7637-4836-8314-05f71f5476f8.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.darknavy.org/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/a5d9daf9-7637-4836-8314-05f71f5476f8.png"><meta name=twitter:title content="Fatal Vulnerabilities Compromising DJI Control Devices"><meta name=twitter:description content="As logistics drones weave through buildings and surveying equipment delineates urban landscapes, the capillaries of the low-altitude economy are sketching the future with millimeter-level precision.
DARKNAVY consistently focuses on the construction and breaching of drone security defenses. In this research, we discovered a fatal exploit chain in DJI remote control devices, leading to the complete compromise of the security defenses within the DJI remote controller. How can we assist industry leader DJI in fortifying its security defenses? What potential risks do these vulnerabilities reveal? Welcome to read this article."><meta name=twitter:site content="@DarkNavyOrg"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://www.darknavy.org/blog/"},{"@type":"ListItem","position":2,"name":"Fatal Vulnerabilities Compromising DJI Control Devices","item":"https://www.darknavy.org/blog/fatal_vulnerabilities_compromising_dji_control_devices/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Fatal Vulnerabilities Compromising DJI Control Devices","name":"Fatal Vulnerabilities Compromising DJI Control Devices","description":"As logistics drones weave through buildings and surveying equipment delineates urban landscapes, the capillaries of the low-altitude economy are sketching the future with millimeter-level precision.\nDARKNAVY consistently focuses on the construction and breaching of drone security defenses. In this research, we discovered a fatal exploit chain in DJI remote control devices, leading to the complete compromise of the security defenses within the DJI remote controller. How can we assist industry leader DJI in fortifying its security defenses? What potential risks do these vulnerabilities reveal? Welcome to read this article.\n","keywords":[],"articleBody":"As logistics drones weave through buildings and surveying equipment delineates urban landscapes, the capillaries of the low-altitude economy are sketching the future with millimeter-level precision.\nDARKNAVY consistently focuses on the construction and breaching of drone security defenses. In this research, we discovered a fatal exploit chain in DJI remote control devices, leading to the complete compromise of the security defenses within the DJI remote controller. How can we assist industry leader DJI in fortifying its security defenses? What potential risks do these vulnerabilities reveal? Welcome to read this article.\nAs drones and their control systems become increasingly complex, modern drone systems are no longer limited to the aircraft and the remote controller. They also include unattended drone ports, cloud management platforms, and other components, enabling managers to remotely dispatch aerial operations without leaving their offices. These systems can be deployed not only in vast deserts to regularly inspect lines but also in cities for automated patrols.\nDrone ports, integrating control and take-off/landing functions, have become core nodes for remote dispatch. Users can not only manually operate devices through remote controllers but also issue flight missions to drones through airports connected to the cloud.\nWhen we focus on the implementation of complete drone automation, we discover that various attack surfaces exist across remote controllers, airports, the cloud, and the drones themselves.\nThis article will focus on two parts:\nThe DUML protocol used in various DJI devices An exploit chain composed of 5 vulnerabilities in DJI remote controllers DUML Protocol The DUML (DJI Universal Markup Language) protocol is one of DJI’s core protocols, used for communication between various DJI devices and between different components within DJI devices. The unified DUML protocol format enables DJI devices to process various messages from different channels more efficiently.\nWe analyzed DUML-related programs on multiple DJI devices and conducted an in-depth exploration of the protocol content.\nDUML supports multiple versions of protocol formats and communication channels. Each version has corresponding codecs responsible for encoding it into binary format and recovering from it. The encoded content includes a new header carrying information such as the protocol version, total length, and checksum. DUML data packets include the following key fields:\n“Machine” and “host” are similar to IP addresses and ports in network protocols. DUML handlers create routing tables based on the dji.json file on the device. According to the configuration within this file, they forward or distribute DUML data packets to specific consumers based on the “machine” and “host” fields. “Seq id” is the ID of the data packet. A quartet (machine, host, msg id, seq id) can be used to distinguish data packets and identify their corresponding response packets. “Attributes” contain additional attribute information of the data packet, such as whether it is encrypted. “Msg id” consists of two parts: “cmd set id” and “cmd id.” It is mainly used to differentiate between different functions. “Payload” is the payload content defined by the upper-layer application. Under black-box testing conditions, it is difficult to obtain the dji.json file and therefore impossible to know which valid “msg id” (cmd set id / cmd id) values exist. This makes it challenging to analyze the functional interfaces provided by the device.\nWe discovered a difference in DUML response packets between normal functional interfaces and non-existent ones. Therefore, we can probe for valid “msg id” values using a method similar to network port scanning:\nOne attribute within the “attributes” field of the DUML data packet affects how the DUML handler processes the packet upon reception. When this attribute is set to a specific value (attributes = 0b0_01_0_0000), the DUML handler will first respond with an ACK data packet if the corresponding “msg id” is valid (a handler function is registered for it). Additionally, the first byte of the payload in this ACK packet will be 1. Consequently, the validity of a “msg id” can be determined by whether an ACK data packet conforming to this pattern is received. By analyzing the list of functionalities supported by the device through DUML, we can further examine the attack surfaces exposed by the device and identify potential security issues within them.\nHowever, DUML communication requires the device to establish a connection with a device controlled by the attacker.\nRemote Controller DJI remote controllers and drone ports communicate with drones over long distances for control and data transmission through the OcuSync protocol. Therefore, if we could “take over” a remote controller or a drone port, it would undoubtedly help us further our research on drones in operation.\nSo, we bought a DJI RC Plus remote controller…\nThe DJI RC Plus runs a customized Android system that can install APKs.\nIt includes a large number of DJI services, ranging from the application-layer “DJI Agriculture” to system services related to drone control, and further down to DJI TA within the Trusted Execution Environment (TEE).\nThe DJI RC Plus has built multi-layered security mechanisms for drone remote control. At its core is the device root key (rootkey) stored within the TEE.\nIt is called the rootkey because it serves as the foundation for a large number of critical keys in the system. The DJI TA utilizes a Key Derivation Function (KDF) to derive various keys from the rootkey, which are then used by other components during authentication and encryption processes. This approach allows for more convenient and efficient management of various keys within the system, and the security of all these keys depends on the security of the rootkey.\nNaturally, the rootkey receives more protection. It is used exclusively by the DJI TA and is never transmitted out of the TEE. Furthermore, when not in use, it is encrypted using the Hardware Unique Key (HUK) and stored in the device’s high-security storage area, RPMB (Replay Protected Memory Block). This makes it difficult for attackers to obtain the rootkey, even with advanced chip-level physical attack capabilities.\nThis article will describe how we chained together five vulnerabilities by installing an app, bypassing multiple layers of defense mechanisms, executing code within the TEE, and ultimately obtaining the rootkey from the RC Plus remote controller.\n01. CVE-2023-20963 “n-day” We analyzed the details of CVE-2023-20963 in the “Most Unforgivable” Vulnerability Exploitation on DARKNAVY Insights.\nCVE-2023-20963 is a Parcel Mismatch vulnerability in Android android.os.WorkSource class. By exploiting this vulnerability, an attacker can achieve LaunchAnyWhere capability to send arbitrary intents with system privileges.\nThere are many public analyses regarding the exploitation of CVE-2023-20963, so we will not elaborate further here.\nBut why can the already patched CVE-2023-20963 still be exploited on the new version of DJI RC Plus?\nAlthough Google has released patches for the affected Android 11, 12, 12L, and 13, this vulnerability was actually introduced as early as Android 9. At that time, Google had already ended security patch support for Android 9 and 10, so any vulnerabilities in these two versions would no longer receive patch updates.\nAnd the system version of DJI RC Plus is precisely Android 10.\nTherefore, we leveraged the “n-day” CVE-2023-20963 on the DJI RC Plus to gain LaunchAnyWhere capability, allowing us to send arbitrary intents with system privileges.\n02. LaunchAnyWhere → System Arbitrary File Read/Write The impact of sending arbitrary intents with system privileges might be limited, but if…\nWe discovered that the system application Settings APP provides a root-path FileProvider, which allows access to any file under the root directory.\nBy combining LaunchAnyWhere and the root-path FileProvider, we achieved arbitrary file read and write with system privileges.\n03. SELinux “Permissive” In the Android system, not only are different permissions distinguished by user ID (uid), but SELinux is also used for more fine-grained file permission management. Through rules, it restricts that only specific context processes paired with the file’s label can access the file. However…\nIn RC Plus, SELinux is not configured in Enforcing mode, so its protection is actually ineffective.\nThis allows us to use a very old (2017) exploitation technique: overwriting the optimized dex bytecode files in the /data/dalvik-cache/ directory to transform arbitrary system file read/write into arbitrary system code execution.\nFurthermore, because SELinux is not enabled, the TEE driver (/dev/qseecom), which the system_app context originally could not be accessed, but becomes accessible to us.\nAt this point, we have obtained the ability to interact with the TA in TEE through three vulnerabilities on the Android side.\nSo, the next step…\n04. BYPASS TA ASLR To achieve arbitrary code execution within the TA, bypassing ASLR is a crucial step.\nWe discovered an out-of-bounds (OOB) array access vulnerability in DJI TA, which allows for out-of-bounds reading of stack data and returning it.\nThrough this OOB vulnerability, we can dump the return address on the stack, leak the TA’s load address, and thus bypass TA ASLR.\n05. STACKOVERFLOW We discovered another stack overflow vulnerability in DJI TA, which allows for arbitrary-length, arbitrary-content stack overflow.\nTherefore, we exploited the stack frame of the vulnerable function’s parent function to achieve code execution via ROP:\nRead the root key located in RPMB. Decrypt it using HUK. Copy the plaintext root key to the output buffer. Ensure the program returns normally. Ultimately, by combining five vulnerabilities, we achieved arbitrary code execution capability within the TEE of the DJI RC Plus remote controller and obtained the remote controller’s root key. With the root key, we can derive the various keys used by the remote controller for authentication and encryption, thereby enabling further analysis of the communication between the remote controller and the drone.\nWe submitted this series of vulnerabilities to DJI SRC on December 9, 2023. DJI SRC confirmed them as fatal vulnerabilities.\nReferences https://www.ndss-symposium.org/wp-content/uploads/2023/02/ndss2023_f217_paper.pdf https://www.digidow.eu/publications/2021-christof-masterthesis/Christof_2021_MasterThesis_DJIProtocolReverseEngineering.pdf https://www.nowsecure.com/blog/2017/06/16/remote-code-execution-as-system-user-on-samsung-phones/ ","wordCount":"1593","inLanguage":"en","image":"https://www.darknavy.org/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/a5d9daf9-7637-4836-8314-05f71f5476f8.png","datePublished":"2025-03-21T10:01:19+08:00","dateModified":"2025-03-21T10:01:19+08:00","author":{"@type":"Person","name":"DARKNAVY"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.darknavy.org/blog/fatal_vulnerabilities_compromising_dji_control_devices/"},"publisher":{"@type":"Organization","name":"DARKNAVY","logo":{"@type":"ImageObject","url":"https://www.darknavy.org/images/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://www.darknavy.org/ accesskey=h title="  (Alt + H)"><img src=https://www.darknavy.org/images/darknavy_shenlan_dot.png alt aria-label=logo height=20></a><div class=logo-switches><ul class=lang-switch><li>|</li><li><a href=https://www.darknavy.org/zh/ title=Chinese aria-label=Chinese>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://www.darknavy.org/ title=Home><span>Home</span></a></li><li><a href=https://www.darknavy.org/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://www.darknavy.org/darknavy_insight/ title=Insight><span>Insight</span></a></li><li><a href=https://www.darknavy.org/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.darknavy.org/>Home</a>&nbsp;»&nbsp;<a href=https://www.darknavy.org/blog/>Blog</a></div><h1 class="post-title entry-hint-parent">Fatal Vulnerabilities Compromising DJI Control Devices</h1><div class=post-meta><span title='2025-03-21 10:01:19 +0800 CST'>March 21, 2025</span>&nbsp;·&nbsp;1593 words&nbsp;·&nbsp;DARKNAVY</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#duml-protocol>DUML Protocol</a></li><li><a href=#remote-controller>Remote Controller</a><ul><li><a href=#01-cve-2023-20963-n-day>01. CVE-2023-20963 &ldquo;n-day&rdquo;</a></li><li><a href=#02-launchanywhere--system-arbitrary-file-readwrite>02. LaunchAnyWhere → System Arbitrary File Read/Write</a></li><li><a href=#03-selinux-permissive>03. SELinux &ldquo;Permissive&rdquo;</a></li><li><a href=#04-bypass-ta-aslr>04. BYPASS TA ASLR</a></li><li><a href=#05-stackoverflow>05. STACKOVERFLOW</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></details></div><div class=post-content><p>As logistics drones weave through buildings and surveying equipment delineates urban landscapes, the capillaries of the low-altitude economy are sketching the future with millimeter-level precision.</p><p>DARKNAVY consistently focuses on the construction and breaching of drone security defenses. In this research, we discovered <strong>a fatal exploit chain in DJI remote control devices</strong>, leading to the complete compromise of the security defenses within the DJI remote controller. How can we assist industry leader DJI in fortifying its security defenses? What potential risks do these vulnerabilities reveal? Welcome to read this article.</p><hr><p>As drones and their control systems become increasingly complex, modern drone systems are no longer limited to the aircraft and the remote controller. They also include unattended drone ports, cloud management platforms, and other components, enabling managers to remotely dispatch aerial operations without leaving their offices. These systems can be deployed not only in vast deserts to regularly inspect lines but also in cities for automated patrols.</p><p>Drone ports, integrating control and take-off/landing functions, have become core nodes for remote dispatch. Users can not only manually operate devices through remote controllers but also issue flight missions to drones through airports connected to the cloud.</p><p><img alt="DJI Port" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/e6e73689-c0ee-4642-b5c5-aeffe29711d4.gif></p><p>When we focus on the implementation of complete drone automation, we discover that various attack surfaces exist across remote controllers, airports, the cloud, and the drones themselves.</p><p><img alt="Drone Control System Architecture" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/a5d9daf9-7637-4836-8314-05f71f5476f8.png></p><p>This article will focus on two parts:</p><ul><li><strong>The DUML protocol used in various DJI devices</strong></li><li><strong>An exploit chain composed of 5 vulnerabilities in DJI remote controllers</strong></li></ul><h2 id=duml-protocol>DUML Protocol<a hidden class=anchor aria-hidden=true href=#duml-protocol>#</a></h2><p>The DUML (DJI Universal Markup Language) protocol is one of DJI&rsquo;s core protocols, used for communication between various DJI devices and between different components within DJI devices. The unified DUML protocol format enables DJI devices to process various messages from different channels more efficiently.</p><p>We analyzed DUML-related programs on multiple DJI devices and conducted an in-depth exploration of the protocol content.</p><p>DUML supports multiple versions of protocol formats and communication channels. Each version has corresponding codecs responsible for encoding it into binary format and recovering from it. The encoded content includes a new header carrying information such as the protocol version, total length, and checksum. DUML data packets include the following key fields:</p><p><img loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/46262e07-e83a-487f-b59d-8f3527212db7.png></p><blockquote><ul><li>&ldquo;Machine&rdquo; and &ldquo;host&rdquo; are similar to IP addresses and ports in network protocols. DUML handlers create routing tables based on the <code>dji.json</code> file on the device. According to the configuration within this file, they forward or distribute DUML data packets to specific consumers based on the &ldquo;machine&rdquo; and &ldquo;host&rdquo; fields.</li><li>&ldquo;Seq id&rdquo; is the ID of the data packet. A quartet (<code>machine, host, msg id, seq id</code>) can be used to distinguish data packets and identify their corresponding response packets.</li><li>&ldquo;Attributes&rdquo; contain additional attribute information of the data packet, such as whether it is encrypted.</li><li>&ldquo;Msg id&rdquo; consists of two parts: &ldquo;cmd set id&rdquo; and &ldquo;cmd id.&rdquo; It is mainly used to differentiate between different functions.</li><li>&ldquo;Payload&rdquo; is the payload content defined by the upper-layer application.</li></ul></blockquote><p>Under black-box testing conditions, it is difficult to obtain the <code>dji.json</code> file and therefore impossible to know which valid &ldquo;msg id&rdquo; (cmd set id / cmd id) values exist. This makes it challenging to analyze the functional interfaces provided by the device.</p><p>We discovered a difference in DUML response packets between normal functional interfaces and non-existent ones. Therefore, we can probe for valid &ldquo;msg id&rdquo; values using a method similar to network port scanning:</p><ul><li>One attribute within the &ldquo;attributes&rdquo; field of the DUML data packet affects how the DUML handler processes the packet upon reception. When this attribute is set to a specific value (<code>attributes = 0b0_01_0_0000</code>), the DUML handler will first respond with an ACK data packet if the corresponding &ldquo;msg id&rdquo; is valid (a handler function is registered for it). Additionally, the first byte of the payload in this ACK packet will be 1. Consequently, the validity of a &ldquo;msg id&rdquo; can be determined by whether an ACK data packet conforming to this pattern is received.</li></ul><p><img loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/984b5b3b-c09a-4267-9fb5-a4274def8537.png></p><p><img alt="Code snippet for detecting DUML functionality" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/035b7da8-fd03-4c29-a69f-f0f1981550c3.png></p><p>By analyzing the list of functionalities supported by the device through DUML, we can further examine the attack surfaces exposed by the device and identify potential security issues within them.</p><p>However, DUML communication requires the device to establish a connection with a device controlled by the attacker.</p><h2 id=remote-controller>Remote Controller<a hidden class=anchor aria-hidden=true href=#remote-controller>#</a></h2><p>DJI remote controllers and drone ports communicate with drones over long distances for control and data transmission through the OcuSync protocol. Therefore, if we could &ldquo;take over&rdquo; a remote controller or a drone port, it would undoubtedly help us further our research on drones in operation.</p><p>So, we bought a DJI RC Plus remote controller&mldr;</p><p><img alt="DJI RC Plus" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/261ed2aa-f55f-4d9e-8065-e2dd3bb81e42.png></p><p>The DJI RC Plus runs a customized Android system that can install APKs.</p><p>It includes a large number of DJI services, ranging from the application-layer &ldquo;DJI Agriculture&rdquo; to system services related to drone control, and further down to DJI TA within the Trusted Execution Environment (TEE).</p><p><img alt="Android system used in DJI RC Plus" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/dd51a886-0406-4595-87fa-0d0185036db1.png></p><p>The DJI RC Plus has built multi-layered security mechanisms for drone remote control. At its core is the device root key (rootkey) stored within the TEE.</p><p>It is called the rootkey because it serves as the foundation for a large number of critical keys in the system. The DJI TA utilizes a Key Derivation Function (KDF) to derive various keys from the rootkey, which are then used by other components during authentication and encryption processes. This approach allows for more convenient and efficient management of various keys within the system, and the security of all these keys depends on the security of the rootkey.</p><p>Naturally, the rootkey receives more protection. It is used exclusively by the DJI TA and is never transmitted out of the TEE. Furthermore, when not in use, it is encrypted using the Hardware Unique Key (HUK) and stored in the device&rsquo;s high-security storage area, RPMB (Replay Protected Memory Block). This makes it difficult for attackers to obtain the rootkey, even with advanced chip-level physical attack capabilities.</p><p><img alt="DJI RC Plus Architecture" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/2c075a31-d6dd-42fe-8276-8c322fcd4d61.png></p><hr><p>This article will describe how we chained together <strong>five vulnerabilities</strong> by installing an app, bypassing multiple layers of defense mechanisms, executing code within the TEE, and ultimately obtaining the rootkey from the RC Plus remote controller.</p><h3 id=01-cve-2023-20963-n-day>01. CVE-2023-20963 &ldquo;n-day&rdquo;<a hidden class=anchor aria-hidden=true href=#01-cve-2023-20963-n-day>#</a></h3><p>We analyzed the details of CVE-2023-20963 in <a href=https://mp.weixin.qq.com/s/P_EYQxOEupqdU0BJMRqWsw>the &ldquo;Most Unforgivable&rdquo; Vulnerability Exploitation on DARKNAVY Insights</a>.</p><blockquote><p>CVE-2023-20963 is a Parcel Mismatch vulnerability in Android <code>android.os.WorkSource</code> class. By exploiting this vulnerability, an attacker can achieve LaunchAnyWhere capability to send arbitrary intents with system privileges.</p><p>There are many public analyses regarding the exploitation of CVE-2023-20963, so we will not elaborate further here.</p></blockquote><p><strong>But why can the already patched CVE-2023-20963 still be exploited on the new version of DJI RC Plus?</strong></p><p>Although Google has released patches for the affected Android 11, 12, 12L, and 13, this vulnerability was actually introduced as early as Android 9. At that time, Google had already ended security patch support for Android 9 and 10, so any vulnerabilities in these two versions would no longer receive patch updates.</p><p><img loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/ab022c09-67ff-492f-9595-c6ed403ea731.png></p><p><strong>And the system version of DJI RC Plus is precisely Android 10.</strong></p><p>Therefore, we leveraged the &ldquo;n-day&rdquo; CVE-2023-20963 on the DJI RC Plus to gain LaunchAnyWhere capability, allowing us to send arbitrary intents with system privileges.</p><h3 id=02-launchanywhere--system-arbitrary-file-readwrite>02. LaunchAnyWhere → System Arbitrary File Read/Write<a hidden class=anchor aria-hidden=true href=#02-launchanywhere--system-arbitrary-file-readwrite>#</a></h3><p>The impact of sending arbitrary intents with system privileges might be limited, but if…</p><p><img alt="root-path FileProvider in Settings APP" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/dc78d80a-4562-425a-9325-28fbf3450c92.png></p><p>We discovered that the system application Settings APP provides a root-path FileProvider, which <strong>allows access to any file under the root directory</strong>.</p><p>By combining LaunchAnyWhere and the root-path FileProvider, we achieved arbitrary file read and write with system privileges.</p><h3 id=03-selinux-permissive>03. SELinux &ldquo;Permissive&rdquo;<a hidden class=anchor aria-hidden=true href=#03-selinux-permissive>#</a></h3><p>In the Android system, not only are different permissions distinguished by user ID (uid), but SELinux is also used for more fine-grained file permission management. Through rules, it restricts that only specific context processes paired with the file&rsquo;s label can access the file. However…</p><p><img alt="SELinux in RC Plus is in Permissive mode" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/8ae99f9e-9f06-4a21-81dd-9882bb4b40ac.png></p><p>In RC Plus, SELinux is not configured in Enforcing mode, so its protection is actually ineffective.</p><p>This allows us to use a very old (2017) exploitation technique: overwriting the optimized dex bytecode files in the <code>/data/dalvik-cache/</code> directory to transform arbitrary system file read/write into arbitrary system code execution.</p><p><img alt="The reverse shell obtained through system code execution" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/ec5306d8-0eb5-4f3b-9cad-048a5bf4c998.png></p><p>Furthermore, because SELinux is not enabled, the TEE driver (<code>/dev/qseecom</code>), which the <code>system_app</code> context originally could not be accessed, but becomes accessible to us.</p><p><img loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/16508314-e9bf-4ae0-b4fc-141b899b9b4d.png></p><p><img alt="SELinux policy in RC Plus" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/20458cac-7abf-4cc6-8d19-11a23444ddac.png></p><p>At this point, we have obtained the ability to interact with the TA in TEE through three vulnerabilities on the Android side.</p><p>So, the next step…</p><h3 id=04-bypass-ta-aslr>04. BYPASS TA ASLR<a hidden class=anchor aria-hidden=true href=#04-bypass-ta-aslr>#</a></h3><p>To achieve arbitrary code execution within the TA, bypassing ASLR is a crucial step.</p><p>We discovered an out-of-bounds (OOB) array access vulnerability in DJI TA, which allows for out-of-bounds reading of stack data and returning it.</p><p><img alt=Pseudocode loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/0af46f6c-c977-4282-a320-a5604b796478.png></p><p>Through this OOB vulnerability, we can dump the return address on the stack, leak the TA&rsquo;s load address, and thus bypass TA ASLR.</p><p><img alt="Leaked TA base address" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/d1ae6601-476f-4279-8911-a33ae5ae2a34.png></p><h3 id=05-stackoverflow>05. STACKOVERFLOW<a hidden class=anchor aria-hidden=true href=#05-stackoverflow>#</a></h3><p>We discovered another stack overflow vulnerability in DJI TA, which allows for arbitrary-length, arbitrary-content stack overflow.</p><p><img alt=Pseudocode loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/f5b7cf62-45a9-4776-81cc-fb1aadeba4b9.png></p><p>Therefore, we exploited the stack frame of the vulnerable function&rsquo;s parent function to achieve code execution via ROP:</p><ol><li>Read the root key located in RPMB.</li><li>Decrypt it using HUK.</li><li>Copy the plaintext root key to the output buffer.</li><li>Ensure the program returns normally.</li></ol><p><img alt="The 16-byte root key read in TA via ROP" loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/59b91dfe-85da-4e2f-9e7b-3cc2c08ec98e.png></p><p>Ultimately, by combining five vulnerabilities, we achieved arbitrary code execution capability within the TEE of the DJI RC Plus remote controller and obtained the remote controller&rsquo;s root key. With the root key, we can derive the various keys used by the remote controller for authentication and encryption, thereby enabling further analysis of the communication between the remote controller and the drone.</p><p>We submitted this series of vulnerabilities to DJI SRC on December 9, 2023. DJI SRC confirmed them as <strong>fatal</strong> vulnerabilities.</p><p><img loading=lazy src=/blog/fatal_vulnerabilities_compromising_dji_control_devices/attachments/8a9307e9-378d-4595-9994-ae55dc408d88.png></p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://www.ndss-symposium.org/wp-content/uploads/2023/02/ndss2023_f217_paper.pdf>https://www.ndss-symposium.org/wp-content/uploads/2023/02/ndss2023_f217_paper.pdf</a></li><li><a href=https://www.digidow.eu/publications/2021-christof-masterthesis/Christof_2021_MasterThesis_DJIProtocolReverseEngineering.pdf>https://www.digidow.eu/publications/2021-christof-masterthesis/Christof_2021_MasterThesis_DJIProtocolReverseEngineering.pdf</a></li><li><a href=https://www.nowsecure.com/blog/2017/06/16/remote-code-execution-as-system-user-on-samsung-phones/>https://www.nowsecure.com/blog/2017/06/16/remote-code-execution-as-system-user-on-samsung-phones/</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://www.darknavy.org/blog/a_first_glimpse_of_the_starlink_user_ternimal/><span class=title>« Prev</span><br><span>A First Glimpse of the Starlink User Ternimal</span>
</a><a class=next href=https://www.darknavy.org/blog/cve_2024_5274_a_minor_flaw_in_v8_parser_leading_to_catastrophes/><span class=title>Next »</span><br><span>CVE-2024-5274: A Minor Flaw in V8 Parser Leading to Catastrophes</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.darknavy.org/>DARKNAVY</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>