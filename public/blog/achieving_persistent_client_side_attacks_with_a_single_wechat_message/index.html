<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Achieving Persistent Client-Side Attacks with a Single WeChat Message | DARKNAVY</title>
<meta name=keywords content><meta name=description content="From White House staff to battlefield journalists, instant messaging (IM) applications are indispensable communication tools for countless individuals. Whether it&rsquo;s WhatsApp, Telegram, WeChat, or QQ, they have become the &ldquo;digital arteries&rdquo; of modern society, carrying core activities such as social interaction, payments, and office work for billions of users. Their security directly affects personal privacy, financial assets, and even national security.
In fact, security research on IM platforms has been ongoing for years. In 2019, Project Zero disclosed CVE-2019-8641 in iMessage[1], a memory corruption issue. Since iMessage automatically parses rich media content in messages, an attacker could achieve remote code execution by sending a specially crafted file without user interaction, gaining complete control over the target iPhone."><meta name=author content="DARKNAVY"><link rel=canonical href=https://www.darknavy.org/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/><link crossorigin=anonymous href=/assets/css/stylesheet.2613b1460fae4b99a98c033e33bde5e6a3af84ddb20236b732cefe33e3c0781e.css integrity="sha256-JhOxRg+uS5mpjAM+M73l5qOvhN2yAja3Ms7+M+PAeB4=" rel="preload stylesheet" as=style><link rel=icon href=https://www.darknavy.org/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.darknavy.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.darknavy.org/favicon-32x32.png><link rel=apple-touch-icon href=https://www.darknavy.org/apple-touch-icon.png><link rel=mask-icon href=https://www.darknavy.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.darknavy.org/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-LR4ZN1LSPS"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LR4ZN1LSPS")}</script><meta property="og:url" content="https://www.darknavy.org/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/"><meta property="og:site_name" content="DARKNAVY"><meta property="og:title" content="Achieving Persistent Client-Side Attacks with a Single WeChat Message"><meta property="og:description" content="From White House staff to battlefield journalists, instant messaging (IM) applications are indispensable communication tools for countless individuals. Whether it’s WhatsApp, Telegram, WeChat, or QQ, they have become the “digital arteries” of modern society, carrying core activities such as social interaction, payments, and office work for billions of users. Their security directly affects personal privacy, financial assets, and even national security.
In fact, security research on IM platforms has been ongoing for years. In 2019, Project Zero disclosed CVE-2019-8641 in iMessage[1], a memory corruption issue. Since iMessage automatically parses rich media content in messages, an attacker could achieve remote code execution by sending a specially crafted file without user interaction, gaining complete control over the target iPhone."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-05-30T11:25:22+08:00"><meta property="article:modified_time" content="2025-05-30T11:25:22+08:00"><meta property="og:image" content="https://www.darknavy.org/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/ee59f925-6fe8-4762-aa32-028b09486308.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.darknavy.org/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/ee59f925-6fe8-4762-aa32-028b09486308.png"><meta name=twitter:title content="Achieving Persistent Client-Side Attacks with a Single WeChat Message"><meta name=twitter:description content="From White House staff to battlefield journalists, instant messaging (IM) applications are indispensable communication tools for countless individuals. Whether it&rsquo;s WhatsApp, Telegram, WeChat, or QQ, they have become the &ldquo;digital arteries&rdquo; of modern society, carrying core activities such as social interaction, payments, and office work for billions of users. Their security directly affects personal privacy, financial assets, and even national security.
In fact, security research on IM platforms has been ongoing for years. In 2019, Project Zero disclosed CVE-2019-8641 in iMessage[1], a memory corruption issue. Since iMessage automatically parses rich media content in messages, an attacker could achieve remote code execution by sending a specially crafted file without user interaction, gaining complete control over the target iPhone."><meta name=twitter:site content="@DarkNavyOrg"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://www.darknavy.org/blog/"},{"@type":"ListItem","position":2,"name":"Achieving Persistent Client-Side Attacks with a Single WeChat Message","item":"https://www.darknavy.org/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Achieving Persistent Client-Side Attacks with a Single WeChat Message","name":"Achieving Persistent Client-Side Attacks with a Single WeChat Message","description":"From White House staff to battlefield journalists, instant messaging (IM) applications are indispensable communication tools for countless individuals. Whether it\u0026rsquo;s WhatsApp, Telegram, WeChat, or QQ, they have become the \u0026ldquo;digital arteries\u0026rdquo; of modern society, carrying core activities such as social interaction, payments, and office work for billions of users. Their security directly affects personal privacy, financial assets, and even national security.\nIn fact, security research on IM platforms has been ongoing for years. In 2019, Project Zero disclosed CVE-2019-8641 in iMessage[1], a memory corruption issue. Since iMessage automatically parses rich media content in messages, an attacker could achieve remote code execution by sending a specially crafted file without user interaction, gaining complete control over the target iPhone.\n","keywords":[],"articleBody":"From White House staff to battlefield journalists, instant messaging (IM) applications are indispensable communication tools for countless individuals. Whether it’s WhatsApp, Telegram, WeChat, or QQ, they have become the “digital arteries” of modern society, carrying core activities such as social interaction, payments, and office work for billions of users. Their security directly affects personal privacy, financial assets, and even national security.\nIn fact, security research on IM platforms has been ongoing for years. In 2019, Project Zero disclosed CVE-2019-8641 in iMessage[1], a memory corruption issue. Since iMessage automatically parses rich media content in messages, an attacker could achieve remote code execution by sending a specially crafted file without user interaction, gaining complete control over the target iPhone.\nIn this article, DARKNAVY will take WeChat as an example, exploring typical scenarios such as URL parsing, file processing, and web page access, to systematically examine key attack surfaces in instant messaging clients and analyze the game of offense and defense behind them.\nOverview of IM Attack Surfaces From an architectural perspective, the attack surface of IM applications can be divided into three main dimensions, namely the client level, the communication protocol level, and the cloud service level. This article will focus on analyzing the attack surface of client level, exploring security issues that could lead to remote code execution or the leakage of sensitive information.\n1. URL Links Most IM clients support custom protocols (such as weixin://, tg://) to achieve in-app navigation. However, attackers can exploit clients’ lax URL validation by crafting malicious requests, tricking users into visiting phishing sites. More covertly, attackers can abuse special function URLs. For instance, slack://settings can change settings. Attackers could construct links with specific parameters, then trick users into clicking them to steal data[2].\n2. File Processing To enhance user experience, IM clients typically implement their own file processing logic to support file previews and content extraction. Attackers can exploit vulnerabilities in these processing functions by crafting specially designed malicious files to achieve remote code execution. For example, CVE-2019-11932[3] and CVE-2025-30401[4] are critical vulnerabilities found in WhatsApp’s Android and Windows clients, respectively. The former is triggered via a malicious GIF file, while the latter uses an executable file disguised as an image to trick users into running it.\n3. Built-in Browser Components Most IM clients come with an embedded browser to support web access, typically using a customized Chromium-based engine. The primary attack surfaces of these browsers come from two aspects: JSBridge: If the client does not implement fine-grained permission controls over the interfaces exposed to web pages, a malicious webpage could exploit this to abuse permissions. Browser Engine Vulnerabilities: For instance, in a 2023 advisory[5], DARKNAVY highlighted that CVE-2023-41064 and CVE-2023-4863 in the libwebp component of the Chromium engine affected several mainstream IM applications including WeChat, DingTalk, and QQ. 4. Mini-Program Ecosystem To expand service capabilities, IM clients like WeChat and DingTalk have launched mini-program platforms, granting third-party developers extensive system permissions, such as file system access, sensor invocation, and API calls. However, if the client lacks proper permission management or has flaws in feature implementation, attackers can leverage malicious mini-programs to carry out attacks.\nWeChat Attack Surface Analysis The DARKNAVY conducted a preliminary assessment of the WeChat client’s attack surface. The following will introduce the main security risks faced by the WeChat client from multiple dimensions, along with corresponding mitigation mechanisms.\n1. WeChat URL Links The WeChat client includes a built-in debugging URL mechanism. When a user accesses a URL containing debugxweb.qq.com, different debugging behaviors can be triggered based on the parameters of the URL. For instance, the parameter show_webview_version will display the current WebView version and related configuration information on the page.\nWhile this mechanism is convenient for debugging, it can pose security risks if an attacker crafts a malicious URL and tricks the user into visiting it. High-risk actions, such as version rollbacks or configuration changes, could potentially be triggered without the user’s awareness. To mitigate this, the WeChat client restricts sensitive operations (like install_embed_plugin) to only execute when the bEnableLocalDebug option is enabled. Furthermore, for functionalities like set_config_url, which allow modification of the configuration-fetching URL, WeChat enforces strict validation of domain and protocol: only HTTPS is permitted, and the domain must be either dldir1.qq.com or dldir1v6.qq.com. This significantly reduces the risk of configuration tampering.\nAdditionally, WeChat supports internal navigation via the weixin:// protocol. For example, weixin://dl/ can be used for page routing. For links containing the ticket parameter, the WeChat client sends a request to the cloud endpoint /cgi-bin/mmbiz-bin/translatelink to retrieve the actual destination URL. This helps prevent attackers from crafting fake links to redirect users to arbitrary pages, thereby enhancing the security of in-app link redirection.\n2. WeChat’s Built-in Browser (XWEB) The Android version of WeChat uses its self-developed XWEB engine, which is based on Chromium. As of the time of writing, the development version of the XWEB kernel uses Chromium version 134.0.6998.136, while the version deployed on production is 130.0.6723.103. In comparison, the official Chrome browser is at version 136.0.7103.93. Although XWEB maintains a relatively up-to-date Chromium base, it still lags behind the official release, potentially exposing it to known vulnerabilities that have not yet been patched.\nTo enhance browser security, WeChat has enabled a multi-process sandboxing mechanism by default. The main process runs in xweb_privileged_process_0, while the rendering process is isolated in xweb_sandboxed_process_0, effectively mitigating the impact of rendering process vulnerabilities.\nWeChat also provides a wide range of JSBridge interfaces that allow webpages to invoke native functions. For example, sendEmail redirects to the email interface, and scanQRCode activates the camera to scan QR codes.\nTo prevent abuse, the WeChat client requests a permission array from the cloud when loading a webpage. This allows for fine-grained control over whether each JSBridge interface is available. On certain official test web pages, most interfaces are enabled by default, while on general web pages, only a few are accessible. This permission control strategy, based on the URL of the page, effectively limits the destructive potential of malicious websites.\n3. WeChat Mini-Program Security Mechanisms WeChat mini-programs are developed using JavaScript and follow an architecture divided into a rendering layer and a logic layer, which run in separate, isolated threads. The rendering layer handles the UI display, while the logic layer is responsible for business logic. JavaScript code written for the logic layer cannot access browser-exposed DOM APIs, and scripts running in the rendering layer cannot invoke high-privilege functions intended for the logic layer.\nThe JSAPI functions exposed by the WeChat client to these two layers differ accordingly. For example, the rendering layer can call APIs such as insertVideoPlayer and insertTextArea, while the logic layer can access functions like saveFile and addDownloadTask. This isolation prevents attackers from leveraging XSS vulnerabilities in mini-programs to execute high-privilege actions in the rendering layer.\nConclusion As one of the most representative IM applications in China, WeChat demonstrates a multi-layered approach to security and fine-grained permission management, especically in its JSBridge access control, browser sandboxing, and dual-thread architecture for mini-programs. These designs reflect WeChat’s strong emphasis on security.\nAs a research team dedicated to IM security, DARKNAVY hopes to drive the IM ecosystem forward in a more robust, secure, and trustworthy manner through continuous vulnerability research, attack and defense analysis, and technical sharing, all while ensuring a smooth user experience.\nReference [1] https://googleprojectzero.blogspot.com/2020/01/remote-iphone-exploitation-part-3.html [2] https://medium.com/tenable-techblog/stealing-downloads-from-slack-users-be6829a55f63 [3] https://awakened1712.github.io/hacking/hacking-whatsapp-gif-rce/ [4] https://www.facebook.com/security/advisories/cve-2025-30401 [5] https://mp.weixin.qq.com/s/zqxkYk7vRvDPKxgoVj1PRw ","wordCount":"1222","inLanguage":"en","image":"https://www.darknavy.org/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/ee59f925-6fe8-4762-aa32-028b09486308.png","datePublished":"2025-05-30T11:25:22+08:00","dateModified":"2025-05-30T11:25:22+08:00","author":{"@type":"Person","name":"DARKNAVY"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.darknavy.org/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/"},"publisher":{"@type":"Organization","name":"DARKNAVY","logo":{"@type":"ImageObject","url":"https://www.darknavy.org/images/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://www.darknavy.org/ accesskey=h title="  (Alt + H)"><img src=https://www.darknavy.org/images/darknavy_shenlan_dot.png alt aria-label=logo height=20></a><div class=logo-switches><ul class=lang-switch><li>|</li><li><a href=https://www.darknavy.org/zh/ title=Chinese aria-label=Chinese>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://www.darknavy.org/ title=Home><span>Home</span></a></li><li><a href=https://www.darknavy.org/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://www.darknavy.org/darknavy_insight/ title=Insight><span>Insight</span></a></li><li><a href=https://www.darknavy.org/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.darknavy.org/>Home</a>&nbsp;»&nbsp;<a href=https://www.darknavy.org/blog/>Blog</a></div><h1 class="post-title entry-hint-parent">Achieving Persistent Client-Side Attacks with a Single WeChat Message</h1><div class=post-meta><span title='2025-05-30 11:25:22 +0800 CST'>May 30, 2025</span>&nbsp;·&nbsp;1222 words&nbsp;·&nbsp;DARKNAVY</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview-of-im-attack-surfaces>Overview of IM Attack Surfaces</a><ul><li><a href=#1-url-links>1. URL Links</a></li><li><a href=#2-file-processing>2. File Processing</a></li><li><a href=#3-built-in-browser-components>3. Built-in Browser Components</a></li><li><a href=#4-mini-program-ecosystem>4. Mini-Program Ecosystem</a></li></ul></li><li><a href=#wechat-attack-surface-analysis>WeChat Attack Surface Analysis</a><ul><li><a href=#1-wechat-url-links>1. WeChat URL Links</a></li><li><a href=#2-wechats-built-in-browser-xweb>2. WeChat&rsquo;s Built-in Browser (XWEB)</a></li><li><a href=#3-wechat-mini-program-security-mechanisms>3. WeChat Mini-Program Security Mechanisms</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></details></div><div class=post-content><p>From White House staff to battlefield journalists, instant messaging (IM) applications are indispensable communication tools for countless individuals. Whether it&rsquo;s WhatsApp, Telegram, WeChat, or QQ, they have become the &ldquo;digital arteries&rdquo; of modern society, carrying core activities such as social interaction, payments, and office work for billions of users. Their security directly affects personal privacy, financial assets, and even national security.</p><p>In fact, security research on IM platforms has been ongoing for years. In 2019, Project Zero disclosed CVE-2019-8641 in iMessage[1], a memory corruption issue. Since iMessage automatically parses rich media content in messages, an attacker could achieve remote code execution by sending a specially crafted file <strong>without user interaction</strong>, gaining complete control over the target iPhone.</p><p>In this article, DARKNAVY will take WeChat as an example, exploring typical scenarios such as URL parsing, file processing, and web page access, to systematically examine key attack surfaces in instant messaging clients and analyze the game of offense and defense behind them.</p><p><video src=attachments/demo.mp4 controls width=100% height=auto></video></p><h2 id=overview-of-im-attack-surfaces>Overview of IM Attack Surfaces<a hidden class=anchor aria-hidden=true href=#overview-of-im-attack-surfaces>#</a></h2><p>From an architectural perspective, the attack surface of IM applications can be divided into three main dimensions, namely the client level, the communication protocol level, and the cloud service level. This article will focus on analyzing the attack surface of client level, exploring security issues that could lead to remote code execution or the leakage of sensitive information.</p><h3 id=1-url-links>1. URL Links<a hidden class=anchor aria-hidden=true href=#1-url-links>#</a></h3><p>Most IM clients support custom protocols (such as <code>weixin://</code>, <code>tg://</code>) to achieve in-app navigation. However, attackers can exploit clients&rsquo; lax URL validation by crafting malicious requests, tricking users into visiting phishing sites. More covertly, attackers can abuse special function URLs. For instance, <code>slack://settings</code> can change settings. Attackers could construct links with specific parameters, then trick users into clicking them to steal data[2].</p><p><img alt="Using the weixin:// Protocol to Launch WeChat" loading=lazy src=/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/5f559069-54f7-4ffd-92c3-d68c34fb78d5.png></p><h3 id=2-file-processing>2. File Processing<a hidden class=anchor aria-hidden=true href=#2-file-processing>#</a></h3><p>To enhance user experience, IM clients typically implement their own file processing logic to support file previews and content extraction. Attackers can exploit vulnerabilities in these processing functions by crafting specially designed malicious files to achieve remote code execution. For example, CVE-2019-11932[3] and CVE-2025-30401[4] are critical vulnerabilities found in WhatsApp&rsquo;s Android and Windows clients, respectively. The former is triggered via a malicious GIF file, while the latter uses an executable file disguised as an image to trick users into running it.</p><h3 id=3-built-in-browser-components>3. Built-in Browser Components<a hidden class=anchor aria-hidden=true href=#3-built-in-browser-components>#</a></h3><ol start=3><li>Most IM clients come with an embedded browser to support web access, typically using a customized Chromium-based engine. The primary attack surfaces of these browsers come from two aspects:</li></ol><ul><li><strong>JSBridge</strong>: If the client does not implement fine-grained permission controls over the interfaces exposed to web pages, a malicious webpage could exploit this to abuse permissions.</li><li><strong>Browser Engine Vulnerabilities</strong>: For instance, in a 2023 advisory[5], DARKNAVY highlighted that CVE-2023-41064 and CVE-2023-4863 in the <code>libwebp</code> component of the Chromium engine affected several mainstream IM applications including WeChat, DingTalk, and QQ.</li></ul><p><img alt="The CVE-2023-41064 and CVE-2023-4863 vulnerabilities affect the WeChat client on Windows platforms." loading=lazy src=/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/12b25d34-da84-4852-881c-313cc74c661d.png></p><h3 id=4-mini-program-ecosystem>4. Mini-Program Ecosystem<a hidden class=anchor aria-hidden=true href=#4-mini-program-ecosystem>#</a></h3><p>To expand service capabilities, IM clients like WeChat and DingTalk have launched mini-program platforms, granting third-party developers extensive system permissions, such as file system access, sensor invocation, and API calls. However, if the client lacks proper permission management or has flaws in feature implementation, attackers can leverage malicious mini-programs to carry out attacks.</p><h2 id=wechat-attack-surface-analysis>WeChat Attack Surface Analysis<a hidden class=anchor aria-hidden=true href=#wechat-attack-surface-analysis>#</a></h2><p>The DARKNAVY conducted a preliminary assessment of the WeChat client&rsquo;s attack surface. The following will introduce the main security risks faced by the WeChat client from multiple dimensions, along with corresponding mitigation mechanisms.</p><h3 id=1-wechat-url-links>1. WeChat URL Links<a hidden class=anchor aria-hidden=true href=#1-wechat-url-links>#</a></h3><p>The WeChat client includes a built-in debugging URL mechanism. When a user accesses a URL containing <code>debugxweb.qq.com</code>, different debugging behaviors can be triggered based on the parameters of the URL. For instance, the parameter <code>show_webview_version</code> will display the current WebView version and related configuration information on the page.</p><p><img alt="Version information displayed via show_webview_version" loading=lazy src=/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/e384d593-d06f-4035-9022-12819d654978.png title=" =257x526"></p><p>While this mechanism is convenient for debugging, it can pose security risks if an attacker crafts a malicious URL and tricks the user into visiting it. High-risk actions, such as version rollbacks or configuration changes, could potentially be triggered without the user&rsquo;s awareness. To mitigate this, the WeChat client restricts sensitive operations (like <code>install_embed_plugin</code>) to only execute when the <code>bEnableLocalDebug</code> option is enabled. Furthermore, for functionalities like <code>set_config_url</code>, which allow modification of the configuration-fetching URL, WeChat enforces strict validation of domain and protocol: only HTTPS is permitted, and the domain must be either <code>dldir1.qq.com</code> or <code>dldir1v6.qq.com</code>. This significantly reduces the risk of configuration tampering.</p><p><img alt="URL validation mechanism for functions like set_config_url" loading=lazy src=/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/a6209bd2-8a45-4267-be98-150595c38c69.png title=" =770x161"></p><p>Additionally, WeChat supports internal navigation via the <code>weixin://</code> protocol. For example, <code>weixin://dl/</code> can be used for page routing. For links containing the <code>ticket</code> parameter, the WeChat client sends a request to the cloud endpoint <code>/cgi-bin/mmbiz-bin/translatelink</code> to retrieve the actual destination URL. This helps prevent attackers from crafting fake links to redirect users to arbitrary pages, thereby enhancing the security of in-app link redirection.</p><h3 id=2-wechats-built-in-browser-xweb>2. WeChat&rsquo;s Built-in Browser (XWEB)<a hidden class=anchor aria-hidden=true href=#2-wechats-built-in-browser-xweb>#</a></h3><p>The Android version of WeChat uses its self-developed XWEB engine, which is based on Chromium. As of the time of writing, the development version of the XWEB kernel uses Chromium version <strong>134.0.6998.136</strong>, while the version deployed on production is <strong>130.0.6723.103</strong>. In comparison, the official Chrome browser is at <strong>version 136.0.7103.93</strong>. Although XWEB maintains a relatively up-to-date Chromium base, it still lags behind the official release, potentially exposing it to known vulnerabilities that have not yet been patched.</p><p>To enhance browser security, WeChat has enabled a multi-process sandboxing mechanism by default. The main process runs in <code>xweb_privileged_process_0</code>, while the rendering process is isolated in <code>xweb_sandboxed_process_0</code>, effectively mitigating the impact of rendering process vulnerabilities.</p><p><img alt="Process isolation in the Android WeChat client" loading=lazy src=/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/3100441a-ec49-484b-9660-e4b03d7cd20e.png></p><p>WeChat also provides a wide range of <strong>JSBridge</strong> interfaces that allow webpages to invoke native functions. For example, <code>sendEmail</code> redirects to the email interface, and <code>scanQRCode</code> activates the camera to scan QR codes.</p><p><img alt="Using sendEmail to enter the email interface" loading=lazy src=/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/566797fc-ec34-48ea-ac24-f84ca363dce8.png title=" =385x253"></p><p>To prevent abuse, the WeChat client requests a permission array from the cloud when loading a webpage. This allows for fine-grained control over whether each JSBridge interface is available. On certain official test web pages, most interfaces are enabled by default, while on general web pages, only a few are accessible. This permission control strategy, based on the URL of the page, effectively limits the destructive potential of malicious websites.</p><h3 id=3-wechat-mini-program-security-mechanisms>3. WeChat Mini-Program Security Mechanisms<a hidden class=anchor aria-hidden=true href=#3-wechat-mini-program-security-mechanisms>#</a></h3><p>WeChat mini-programs are developed using JavaScript and follow an architecture divided into a <strong>rendering layer</strong> and a <strong>logic layer</strong>, which run in separate, isolated threads. The rendering layer handles the UI display, while the logic layer is responsible for business logic. JavaScript code written for the logic layer cannot access browser-exposed DOM APIs, and scripts running in the rendering layer cannot invoke high-privilege functions intended for the logic layer.</p><p>The JSAPI functions exposed by the WeChat client to these two layers differ accordingly. For example, the rendering layer can call APIs such as <code>insertVideoPlayer</code> and <code>insertTextArea</code>, while the logic layer can access functions like <code>saveFile</code> and <code>addDownloadTask</code>. This isolation prevents attackers from leveraging XSS vulnerabilities in mini-programs to execute high-privilege actions in the rendering layer.</p><p><img alt="addToPagePool adds JSAPI functions to the rendering layer" loading=lazy src=/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/5faa719f-ef34-44ec-a797-f921cefac225.png></p><p><img alt="Some JSAPIs available to the rendering layer" loading=lazy src=/blog/achieving_persistent_client_side_attacks_with_a_single_wechat_message/attachments/ee59f925-6fe8-4762-aa32-028b09486308.png></p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>As one of the most representative IM applications in China, WeChat demonstrates a multi-layered approach to security and fine-grained permission management, especically in its JSBridge access control, browser sandboxing, and dual-thread architecture for mini-programs. These designs reflect WeChat&rsquo;s strong emphasis on security.</p><p>As a research team dedicated to IM security, DARKNAVY hopes to drive the IM ecosystem forward in a more robust, secure, and trustworthy manner through continuous vulnerability research, attack and defense analysis, and technical sharing, all while ensuring a smooth user experience.</p><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><ul><li>[1] https://googleprojectzero.blogspot.com/2020/01/remote-iphone-exploitation-part-3.html</li><li>[2] https://medium.com/tenable-techblog/stealing-downloads-from-slack-users-be6829a55f63</li><li>[3] https://awakened1712.github.io/hacking/hacking-whatsapp-gif-rce/</li><li>[4] https://www.facebook.com/security/advisories/cve-2025-30401</li><li>[5] https://mp.weixin.qq.com/s/zqxkYk7vRvDPKxgoVj1PRw</li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://www.darknavy.org/blog/argusee_a_multi_agent_collaborative_architecture_for_automated_vulnerability_discovery/><span class=title>Next »</span><br><span>Argusee: A Multi-Agent Collaborative Architecture for Automated Vulnerability Discovery</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.darknavy.org/>DARKNAVY</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>