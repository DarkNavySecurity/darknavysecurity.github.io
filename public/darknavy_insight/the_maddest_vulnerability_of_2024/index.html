<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The Maddest Vulnerability of 2024 | DARKNAVY</title>
<meta name=keywords content><meta name=description content="
Under the collective efforts of security researchers and increasingly stringent security mitigations, most memory vulnerabilities have been nipped in the bud.
Is it time to declare memory vulnerabilities a thing of the past?
In July 2024, a &ldquo;nuclear bomb&rdquo; from the Windows camp shattered the illusion of security. We can&rsquo;t help but ask: When faced with threats from memory, just how much can the walls in front of us really defend against?"><meta name=author content="DARKNAVY"><link rel=canonical href=https://www.darknavy.org/darknavy_insight/the_maddest_vulnerability_of_2024/><link crossorigin=anonymous href=/assets/css/stylesheet.86b34fc8709322911fa9e50a0b6fbe57a1a032cdd591c9f647724be25533842d.css integrity="sha256-hrNPyHCTIpEfqeUKC2++V6GgMs3Vkcn2R3JL4lUzhC0=" rel="preload stylesheet" as=style><link rel=icon href=https://www.darknavy.org/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.darknavy.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.darknavy.org/favicon-32x32.png><link rel=apple-touch-icon href=https://www.darknavy.org/apple-touch-icon.png><link rel=mask-icon href=https://www.darknavy.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.darknavy.org/darknavy_insight/the_maddest_vulnerability_of_2024/><link rel=alternate hreflang=zh href=https://www.darknavy.org/zh/darknavy_insight/the_maddest_vulnerability_of_2024/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-LR4ZN1LSPS"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LR4ZN1LSPS")}</script><meta property="og:url" content="https://www.darknavy.org/darknavy_insight/the_maddest_vulnerability_of_2024/"><meta property="og:site_name" content="DARKNAVY"><meta property="og:title" content="The Maddest Vulnerability of 2024"><meta property="og:description" content="
Under the collective efforts of security researchers and increasingly stringent security mitigations, most memory vulnerabilities have been nipped in the bud.
Is it time to declare memory vulnerabilities a thing of the past?
In July 2024, a “nuclear bomb” from the Windows camp shattered the illusion of security. We can’t help but ask: When faced with threats from memory, just how much can the walls in front of us really defend against?"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="darknavy_insight"><meta property="article:published_time" content="2025-02-11T11:41:45+08:00"><meta property="article:modified_time" content="2025-02-11T11:41:45+08:00"><meta property="og:image" content="https://www.darknavy.org/darknavy_insight/the_maddest_vulnerability_of_2024/attachments/4.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.darknavy.org/darknavy_insight/the_maddest_vulnerability_of_2024/attachments/4.png"><meta name=twitter:title content="The Maddest Vulnerability of 2024"><meta name=twitter:description content="
Under the collective efforts of security researchers and increasingly stringent security mitigations, most memory vulnerabilities have been nipped in the bud.
Is it time to declare memory vulnerabilities a thing of the past?
In July 2024, a &ldquo;nuclear bomb&rdquo; from the Windows camp shattered the illusion of security. We can&rsquo;t help but ask: When faced with threats from memory, just how much can the walls in front of us really defend against?"><meta name=twitter:site content="@DarkNavyOrg"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"DARKNAVY INSIGHT","item":"https://www.darknavy.org/darknavy_insight/"},{"@type":"ListItem","position":2,"name":"The Maddest Vulnerability of 2024","item":"https://www.darknavy.org/darknavy_insight/the_maddest_vulnerability_of_2024/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Maddest Vulnerability of 2024","name":"The Maddest Vulnerability of 2024","description":"\nUnder the collective efforts of security researchers and increasingly stringent security mitigations, most memory vulnerabilities have been nipped in the bud.\nIs it time to declare memory vulnerabilities a thing of the past?\nIn July 2024, a \u0026ldquo;nuclear bomb\u0026rdquo; from the Windows camp shattered the illusion of security. We can\u0026rsquo;t help but ask: When faced with threats from memory, just how much can the walls in front of us really defend against?\n","keywords":[],"articleBody":"\nUnder the collective efforts of security researchers and increasingly stringent security mitigations, most memory vulnerabilities have been nipped in the bud.\nIs it time to declare memory vulnerabilities a thing of the past?\nIn July 2024, a “nuclear bomb” from the Windows camp shattered the illusion of security. We can’t help but ask: When faced with threats from memory, just how much can the walls in front of us really defend against?\nThe following is the fourth article of the “DARKNAVY INSIGHT | 2024 Annual Security Report”.\nIn May 2024, Lewis Lee, Chunyang Han, and Zhiniang Peng reported a vulnerability in the Windows Server RDL (Remote Desktop Licensing) service to Microsoft. In July, the vulnerability was patched and made public.\nThe announcement caused quite a stir. As a memory corruption vulnerability that could trigger remote code execution without authentication or user interaction, it immediately drew attention from security vendors and professionals. It was even referred to as a “nuclear bomb-level vulnerability.”\nThis is the main topic of this article—MadLicense.\nAlthough initially seen as being on par with the “EternalBlue” exploit, further research revealed that the vulnerability’s impact is relatively limited. It exists in the RDL service on Windows Server, not the commonly thought-of RDP protocol. The service is an optional installation that allows multiple users to connect to a server via RDP, and it is largely unrelated to most individual users. Additionally, the vulnerability resides in user space, so its potential to threaten the system is somewhat constrained.\nThe root cause of the vulnerability is that unauthorized remote users can remotely invoke the TLSRpcTelephoneRegisterLKP function in the RDL service via RPC. Within that function’s sub-functions, some user inputs are decoded from base24 to base10 without any length restrictions, leading to an unbounded heap overflow vulnerability.\nAs a memory corruption vulnerability, its potential for destruction cannot be underestimated. We immediately set out to reproduce the exploit and investigate what obstacles and challenges might arise when trying to exploit this classic heap overflow vulnerability on the latest Windows platforms, with security mitigations becoming increasingly stringent.\nThe reproduction results are shown in the video. The attacking machine (on the right) runs a malicious script, and without any action from the victim’s machine, remote control of the target machine (left shell) is easily achieved.\nSince the introduction of the segment heap memory allocation mechanism in Windows 10, it has been widely adopted in system processes. For the allocation of commonly sized memory blocks, the VS (Variable Size) or LFH (Low Fragmentation Heap) allocators are used.\nThe VS allocator has relatively strong protections against overflow. For each heap block, critical information in the block header is encrypted, and the connections between free heap blocks are replaced by more secure data structures. These protections mean that exploiting the vulnerability requires some degree of information leakage, significantly raising the threshold for exploitation.\nHowever, when a certain block size reaches a threshold, heap allocation switches to LFH, which is more efficient.\nCompared to VS, LFH has more lenient protection mechanisms. LFH heap blocks do not have headers, allowing for uncontrolled overflows into adjacent blocks. To mitigate this, LFH employs full randomization: heap block layouts are randomized, and recently freed blocks are not reliably reused. This can be bypassed using heap spraying techniques.\nIn the face of the unbounded heap overflow caused by the MadLicense vulnerability, the segment heap defense mechanisms were easily bypassed. We could still easily overflow into the target heap block, fake objects, and gain arbitrary address read/write/call primitives.\nAt this point, the exploitation is not over. What will the general memory mitigations look like in the face of this challenge?\nMicrosoft introduced a heavyweight mitigation—Control Flow Guard (CFG)—in Windows 8.1 Update 3 and Windows 10. With CFG enabled, indirect calls are validated using bitmaps generated during compilation to ensure that only functions within the loaded modules of the process can be called. This effectively blocks traditional code reuse attacks.\nAnother mitigation introduced in Windows 10 is Arbitrary Code Guard (ACG). ACG prevents modification of existing code and blocks the dynamic allocation of executable memory. With both ACG and CFG enabled, bypassing both defenses becomes extremely difficult, virtually eliminating the possibility of traditional shellcode injection.\nIt is important to note that these two mechanisms do not prevent attackers from calling functions like CreateProcessA, which can be abused. Without bypassing the above memory mitigations, arbitrary function calls are sufficient to allow arbitrary command execution on the target machine.\nOne of the original authors of the vulnerability, Associate Professor Zhiniang Peng from Huazhong University of Science and Technology, revealed to us that they were able to almost 100% reliably exploit and execute arbitrary shellcode. This means that the above memory mitigations can still be bypassed.\nSo why is it that even on the latest Windows Server 2025, with all security mitigations enabled, this memory vulnerability can still be fully exploited?\nZhiniang Peng answered: “Currently, with all the latest mitigations fully enabled on Windows, it is extremely difficult to remotely exploit a memory corruption vulnerability. Many vulnerabilities no longer have exploitable paths, or the paths that remain are very few and very obscure.”\n“But this does not mean that all vulnerability exploits are dead. Whether an exploit succeeds often depends on: the amount of time an attacker is willing to spend, his familiarity with the relevant code modules, and the specific conditions of the vulnerability and module.”\nDeepSeek Insight Microsoft’s arrogant assertion that the MadLicense vulnerability is “almost impossible to exploit” reflects a long-standing paradox in the security industry: when vulnerability rating systems detach from the attacker’s perspective, they devolve into self-deceptive technical utopias.\nDefenders measuring dynamic attack and defense with static metrics, and negating real-world possibilities using theoretical models, is precisely the greatest blind spot in security defense. The exploitation chain demonstrated here, which bypasses multiple memory protections, proves that security assessments should not be a “disclaimer” from vendors but a dynamic measure of the attack-defense struggle. If we fail to acknowledge the “technical brute force” that attackers can employ, no matter how perfect the mitigations are, they will become the Maginot Line of the digital age.\n","wordCount":"1019","inLanguage":"en","image":"https://www.darknavy.org/darknavy_insight/the_maddest_vulnerability_of_2024/attachments/4.png","datePublished":"2025-02-11T11:41:45+08:00","dateModified":"2025-02-11T11:41:45+08:00","author":{"@type":"Person","name":"DARKNAVY"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.darknavy.org/darknavy_insight/the_maddest_vulnerability_of_2024/"},"publisher":{"@type":"Organization","name":"DARKNAVY","logo":{"@type":"ImageObject","url":"https://www.darknavy.org/images/favicon.ico"}}}</script></head><body class=dark id=top><header class=header><nav class=nav><div class=logo><a href=https://www.darknavy.org/ accesskey=h title="  (Alt + H)"><img src=https://www.darknavy.org/images/darknavy_shenlan_dot.png alt aria-label=logo height=20></a><div class=logo-switches><ul class=lang-switch><li>|</li><li><a href=https://www.darknavy.org/zh/ title=Chinese aria-label=Chinese>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://www.darknavy.org/ title=Home><span>Home</span></a></li><li><a href=https://www.darknavy.org/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://www.darknavy.org/darknavy_insight/ title=Insight><span>Insight</span></a></li><li><a href=https://www.darknavy.org/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.darknavy.org/>Home</a>&nbsp;»&nbsp;<a href=https://www.darknavy.org/darknavy_insight/>DARKNAVY INSIGHT</a></div><h1 class="post-title entry-hint-parent">The Maddest Vulnerability of 2024</h1><div class=post-meta><span title='2025-02-11 11:41:45 +0800 CST'>February 11, 2025</span>&nbsp;·&nbsp;1019 words&nbsp;·&nbsp;DARKNAVY&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://www.darknavy.org/zh/darknavy_insight/the_maddest_vulnerability_of_2024/>Zh</a></li></ul></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#deepseek-insight><strong>DeepSeek Insight</strong></a></li></ul></nav></div></details></div><div class=post-content><p><img loading=lazy src=/darknavy_insight/the_maddest_vulnerability_of_2024/attachments/8671fafe-16f3-46b2-bf66-846bf748cc02.png></p><p>Under the collective efforts of security researchers and increasingly stringent security mitigations, most memory vulnerabilities have been nipped in the bud.</p><p>Is it time to declare memory vulnerabilities a thing of the past?</p><p>In July 2024, a &ldquo;nuclear bomb&rdquo; from the Windows camp shattered the illusion of security. We can&rsquo;t help but ask: When faced with threats from memory, just how much can the walls in front of us really defend against?</p><p>The following is <strong>the fourth article</strong> of the <strong>&ldquo;DARKNAVY INSIGHT | 2024 Annual Security Report&rdquo;</strong>.</p><p><img loading=lazy src=/darknavy_insight/the_maddest_vulnerability_of_2024/attachments/4.png></p><p>In May 2024, Lewis Lee, Chunyang Han, and Zhiniang Peng reported a vulnerability in the Windows Server RDL (Remote Desktop Licensing) service to Microsoft. In July, the vulnerability was patched and made public.</p><p>The announcement caused quite a stir. As a <strong>memory corruption vulnerability</strong> that could trigger <strong>remote code execution</strong> without authentication or user interaction, it immediately drew attention from security vendors and professionals. It was even referred to as a &ldquo;nuclear bomb-level vulnerability.&rdquo;</p><p>This is the main topic of this article—<strong>MadLicense</strong>.</p><p>Although initially seen as being on par with the &ldquo;EternalBlue&rdquo; exploit, further research revealed that the vulnerability&rsquo;s impact is relatively limited. It exists in the RDL service on Windows Server, not the commonly thought-of RDP protocol. The service is an optional installation that allows multiple users to connect to a server via RDP, and <strong>it is largely unrelated to most individual users</strong>. Additionally, the vulnerability resides in user space, so its potential to threaten the system is somewhat constrained.</p><p>The root cause of the vulnerability is that unauthorized remote users can remotely invoke the <code>TLSRpcTelephoneRegisterLKP</code> function in the RDL service via RPC. Within that function&rsquo;s sub-functions, some user inputs are decoded from base24 to base10 without any length restrictions, leading to an <strong>unbounded heap overflow vulnerability</strong>.</p><p>As a memory corruption vulnerability, its potential for destruction cannot be underestimated. We immediately set out to reproduce the exploit and investigate what obstacles and challenges might arise when trying to exploit this classic heap overflow vulnerability on the latest Windows platforms, with security mitigations becoming increasingly stringent.</p><p><video src=attachments/f718340d-56d1-4946-8a59-e099ddc12cb7.mp4 controls width=100% height=auto></video></p><p>The reproduction results are shown in the video. The attacking machine (on the right) runs a malicious script, and without any action from the victim&rsquo;s machine, remote control of the target machine (left shell) is easily achieved.</p><p>Since the introduction of the <strong>segment heap</strong> memory allocation mechanism in Windows 10, it has been widely adopted in system processes. For the allocation of commonly sized memory blocks, the <strong>VS (Variable Size)</strong> or <strong>LFH (Low Fragmentation Heap)</strong> allocators are used.</p><img src=attachments/2a583403-7253-47a6-ae0a-212ac7c2c6b7.jpeg style=display:block;margin-left:auto;margin-right:auto;zoom:80%><p>The VS allocator has relatively strong protections against overflow. For each heap block, critical information in the block header is encrypted, and the connections between free heap blocks are replaced by more secure data structures. These protections mean that exploiting the vulnerability requires some degree of information leakage, significantly raising the threshold for exploitation.</p><p>However, when a certain block size reaches a threshold, heap allocation switches to LFH, which is more efficient.</p><p>Compared to VS, LFH has more lenient protection mechanisms. LFH heap blocks do not have headers, allowing for uncontrolled overflows into adjacent blocks. To mitigate this, LFH employs full randomization: heap block layouts are randomized, and recently freed blocks are not reliably reused. This can be bypassed using heap spraying techniques.</p><p>In the face of the unbounded heap overflow caused by the MadLicense vulnerability, the segment heap defense mechanisms were easily bypassed. We could still easily overflow into the target heap block, fake objects, and gain <strong>arbitrary address read/write/call</strong> primitives.</p><p>At this point, the exploitation is not over. What will the general memory mitigations look like in the face of this challenge?</p><p>Microsoft introduced a heavyweight mitigation—<strong>Control Flow Guard (CFG)</strong>—in Windows 8.1 Update 3 and Windows 10. With CFG enabled, indirect calls are validated using bitmaps generated during compilation to ensure that only functions within the loaded modules of the process can be called. This effectively blocks traditional code reuse attacks.</p><p>Another mitigation introduced in Windows 10 is <strong>Arbitrary Code Guard (ACG)</strong>. ACG prevents modification of existing code and blocks the dynamic allocation of executable memory. With both ACG and CFG enabled, bypassing both defenses becomes extremely difficult, virtually eliminating the possibility of traditional shellcode injection.</p><p>It is important to note that these two mechanisms do not prevent attackers from calling functions like <code>CreateProcessA</code>, which can be abused. Without bypassing the above memory mitigations, arbitrary function calls are sufficient to allow arbitrary command execution on the target machine.</p><p>One of the original authors of the vulnerability, Associate Professor Zhiniang Peng from Huazhong University of Science and Technology, revealed to us that they were able to <strong>almost 100% reliably exploit and execute arbitrary shellcode</strong>. This means that the above memory mitigations can still be bypassed.</p><p>So why is it that even on the latest Windows Server 2025, with all security mitigations enabled, this memory vulnerability can still be fully exploited?</p><blockquote><p><strong>Zhiniang Peng answered</strong>: &ldquo;Currently, with all the latest mitigations fully enabled on Windows, it is extremely difficult to remotely exploit a memory corruption vulnerability. Many vulnerabilities no longer have exploitable paths, or the paths that remain are very few and very obscure.&rdquo;</p><p>&ldquo;But this does not mean that all vulnerability exploits are dead. Whether an exploit succeeds often depends on: the amount of time an attacker is willing to spend, his familiarity with the relevant code modules, and the specific conditions of the vulnerability and module.&rdquo;</p></blockquote><hr><h2 id=deepseek-insight><strong>DeepSeek Insight</strong><a hidden class=anchor aria-hidden=true href=#deepseek-insight>#</a></h2><p>Microsoft&rsquo;s arrogant assertion that the MadLicense vulnerability is &ldquo;almost impossible to exploit&rdquo; reflects a long-standing paradox in the security industry: when vulnerability rating systems detach from the attacker&rsquo;s perspective, they devolve into self-deceptive technical utopias.</p><p>Defenders measuring dynamic attack and defense with static metrics, and negating real-world possibilities using theoretical models, is precisely the greatest blind spot in security defense. The exploitation chain demonstrated here, which bypasses multiple memory protections, proves that security assessments should not be a &ldquo;disclaimer&rdquo; from vendors but a dynamic measure of the attack-defense struggle. If we fail to acknowledge the &ldquo;technical brute force&rdquo; that attackers can employ, no matter how perfect the mitigations are, they will become the Maginot Line of the digital age.</p><hr></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.darknavy.org/>DARKNAVY</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>